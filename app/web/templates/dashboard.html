{% extends "base.html" %}

{% block title %}Dashboard - {{ user.name }}{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h2>Hey {{ user.name }}! üëã</h2>
    <p class="subtitle">Quick check-in for {{ "today" }}</p>
</div>

{% if daily_message %}
<div class="llm-message">
    <div class="llm-icon">ü§ñ</div>
    <p>{{ daily_message }}</p>
</div>
{% elif llm_available == False %}
<div class="llm-message llm-unavailable">
    <div class="llm-icon">üí§</div>
    <p>LLM insights are not available.</p>
</div>
{% endif %}

<form method="POST" action="{{ url_for('submit_entries', user_id=user.id) }}" class="metrics-form">
    {% if metrics %}
        <div class="metrics-grid">
            {% for metric in metrics %}
            <div class="metric-field">
                <label for="metric_{{ metric.name }}">
                    {{ metric.input_schema().label }}
                    {% if not metric.input_schema().required %}
                    <span class="optional-badge">Optional</span>
                    {% endif %}
                </label>
                
                {% set schema = metric.input_schema() %}
                {% set field_name = "metric_" ~ metric.name %}
                {% set current_value = today_entries.get(metric.name) %}
                
                {% if schema.input_type == "boolean" %}
                    <div class="checkbox-wrapper">
                        <input 
                            type="checkbox" 
                            id="{{ field_name }}" 
                            name="{{ field_name }}"
                            {% if current_value %}checked{% endif %}
                        >
                        <label for="{{ field_name }}" class="checkbox-label">
                            Yes
                        </label>
                    </div>
                    {% if current_value is not none %}
                        <small class="already-logged">‚úì Already logged today</small>
                    {% endif %}
                
                {% elif schema.input_type == "decimal" %}
                    <input 
                        type="number" 
                        id="{{ field_name }}" 
                        name="{{ field_name }}"
                        step="0.1"
                        {% if schema.min_value %}min="{{ schema.min_value }}"{% endif %}
                        {% if schema.max_value %}max="{{ schema.max_value }}"{% endif %}
                        {% if schema.placeholder %}placeholder="{{ schema.placeholder }}"{% endif %}
                        {% if current_value %}value="{{ current_value }}"{% endif %}
                        class="input-field"
                    >
                    {% if current_value is not none %}
                        <small class="already-logged">‚úì Already logged today: {{ current_value }}</small>
                    {% endif %}
                
                {% elif schema.input_type == "integer" %}
                    <input 
                        type="number" 
                        id="{{ field_name }}" 
                        name="{{ field_name }}"
                        step="1"
                        {% if schema.min_value %}min="{{ schema.min_value|int }}"{% endif %}
                        {% if schema.max_value %}max="{{ schema.max_value|int }}"{% endif %}
                        {% if schema.placeholder %}placeholder="{{ schema.placeholder }}"{% endif %}
                        {% if current_value %}value="{{ current_value }}"{% endif %}
                        class="input-field"
                    >
                
                {% elif schema.input_type == "text" %}
                    <textarea 
                        id="{{ field_name }}" 
                        name="{{ field_name }}"
                        rows="3"
                        {% if schema.placeholder %}placeholder="{{ schema.placeholder }}"{% endif %}
                        class="input-field"
                    >{% if current_value %}{{ current_value }}{% endif %}</textarea>
                    {% if current_value is not none %}
                        <small class="already-logged">‚úì Already logged today</small>
                    {% endif %}
                
                {% elif schema.input_type == "select" %}
                    <select 
                        id="{{ field_name }}" 
                        name="{{ field_name }}"
                        class="input-field"
                    >
                        <option value="">Choose...</option>
                        {% for option in schema.options %}
                        <option value="{{ option }}" {% if current_value == option %}selected{% endif %}>
                            {{ option }}
                        </option>
                        {% endfor %}
                    </select>
                    {% if current_value is not none %}
                        <small class="already-logged">‚úì Already logged today: {{ current_value }}</small>
                    {% endif %}
                
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Entries</button>
            <p class="form-note">Skip any fields you don't want to track today</p>
        </div>
    {% else %}
        <div class="empty-state">
            <p>No metrics enabled. Go to <a href="{{ url_for('user_settings', user_id=user.id) }}">Settings</a> to enable some!</p>
        </div>
    {% endif %}
</form>

<div class="quick-links">
    <a href="{{ url_for('user_trends', user_id=user.id) }}" class="quick-link">
        üìä View Trends
    </a>
    <a href="{{ url_for('user_settings', user_id=user.id) }}" class="quick-link">
        ‚öôÔ∏è Settings
    </a>
</div>
{% endblock %}